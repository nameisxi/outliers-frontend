
const data = [
    {"username":"comfuture","year":"2022","min":10,"max":59,"median":35,"p80":43,"p90":45,"p99":55.5,"contributions":[{"week":0,"days":[{"count":24}]},{"week":1,"days":[{"count":26},{"count":34},{"count":45},{"count":40},{"count":46},{"count":38},{"count":24}]},{"week":2,"days":[{"count":24},{"count":40},{"count":45},{"count":43},{"count":35},{"count":41},{"count":24}]},{"week":3,"days":[{"count":30},{"count":45},{"count":36},{"count":35},{"count":40},{"count":36},{"count":27}]},{"week":4,"days":[{"count":24},{"count":37},{"count":41},{"count":38},{"count":44},{"count":43},{"count":35}]},{"week":5,"days":[{"count":24},{"count":28},{"count":30},{"count":29},{"count":39},{"count":36},{"count":24}]},{"week":6,"days":[{"count":24},{"count":41},{"count":43},{"count":36},{"count":36},{"count":34},{"count":24}]},{"week":7,"days":[{"count":24},{"count":44},{"count":37},{"count":34},{"count":39},{"count":44},{"count":25}]},{"week":8,"days":[{"count":24},{"count":41},{"count":39},{"count":37},{"count":43},{"count":37},{"count":33}]},{"week":9,"days":[{"count":45},{"count":50},{"count":27},{"count":34},{"count":37},{"count":37},{"count":24}]},{"week":10,"days":[{"count":24},{"count":44},{"count":37},{"count":24},{"count":49},{"count":59},{"count":42}]},{"week":11,"days":[{"count":24},{"count":34},{"count":50},{"count":37},{"count":41},{"count":40},{"count":24}]},{"week":12,"days":[{"count":24},{"count":56},{"count":44},{"count":36},{"count":37},{"count":41},{"count":24}]},{"week":13,"days":[{"count":40},{"count":43},{"count":54},{"count":45},{"count":37},{"count":46},{"count":25}]},{"week":14,"days":[{"count":28},{"count":36},{"count":35},{"count":34},{"count":36},{"count":55},{"count":24}]},{"week":15,"days":[{"count":24},{"count":34},{"count":46},{"count":39},{"count":50},{"count":31},{"count":24}]},{"week":16,"days":[{"count":24},{"count":41},{"count":43},{"count":32},{"count":10},{"count":22},{"count":26}]},{"week":17,"days":[{"count":24},{"count":34},{"count":34},{"count":38},{"count":33},{"count":35},{"count":24}]},{"week":18,"days":[{"count":24},{"count":37},{"count":44},{"count":34},{"count":24},{"count":34},{"count":24}]},{"week":19,"days":[{"count":24},{"count":43},{"count":36},{"count":35},{"count":39},{"count":34},{"count":24}]},{"week":20,"days":[{"count":25},{"count":34},{"count":54},{"count":34},{"count":34},{"count":34},{"count":24}]},{"week":21,"days":[{"count":24},{"count":23},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":22,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":23,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":24,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":25,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":26,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":27,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":28,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":29,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":30,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":31,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":32,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":33,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":34,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":35,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":36,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":37,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":38,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":39,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":40,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":41,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":42,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":43,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":44,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":45,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":46,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":47,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":48,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":49,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":50,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":51,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]},{"week":52,"days":[{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0},{"count":0}]}]},
    {"username":"comfuture","year":"2021","min":10,"max":70,"median":35,"p80":41,"p90":45.5,"p99":57,"contributions":[{"week":0,"days":[{"count":23},{"count":23}]},{"week":1,"days":[{"count":23},{"count":36},{"count":35},{"count":38},{"count":33},{"count":41},{"count":21}]},{"week":2,"days":[{"count":22},{"count":45},{"count":40},{"count":29},{"count":28},{"count":29},{"count":21}]},{"week":3,"days":[{"count":25},{"count":32},{"count":33},{"count":44},{"count":28},{"count":34},{"count":21}]},{"week":4,"days":[{"count":22},{"count":29},{"count":41},{"count":34},{"count":54},{"count":33},{"count":23}]},{"week":5,"days":[{"count":23},{"count":39},{"count":34},{"count":37},{"count":43},{"count":43},{"count":24}]},{"week":6,"days":[{"count":24},{"count":46},{"count":50},{"count":37},{"count":24},{"count":24},{"count":24}]},{"week":7,"days":[{"count":26},{"count":52},{"count":49},{"count":41},{"count":43},{"count":44},{"count":24}]},{"week":8,"days":[{"count":24},{"count":47},{"count":43},{"count":34},{"count":47},{"count":37},{"count":24}]},{"week":9,"days":[{"count":24},{"count":25},{"count":40},{"count":46},{"count":36},{"count":34},{"count":24}]},{"week":10,"days":[{"count":23},{"count":36},{"count":41},{"count":40},{"count":38},{"count":42},{"count":24}]},{"week":11,"days":[{"count":23},{"count":42},{"count":47},{"count":37},{"count":49},{"count":56},{"count":24}]},{"week":12,"days":[{"count":23},{"count":33},{"count":39},{"count":33},{"count":36},{"count":36},{"count":26}]},{"week":13,"days":[{"count":24},{"count":37},{"count":35},{"count":38},{"count":47},{"count":35},{"count":24}]},{"week":14,"days":[{"count":24},{"count":39},{"count":37},{"count":35},{"count":43},{"count":33},{"count":24}]},{"week":15,"days":[{"count":25},{"count":34},{"count":35},{"count":34},{"count":34},{"count":34},{"count":24}]},{"week":16,"days":[{"count":25},{"count":40},{"count":42},{"count":30},{"count":34},{"count":34},{"count":34}]},{"week":17,"days":[{"count":24},{"count":59},{"count":34},{"count":34},{"count":33},{"count":34},{"count":24}]},{"week":18,"days":[{"count":24},{"count":36},{"count":32},{"count":24},{"count":33},{"count":32},{"count":23}]},{"week":19,"days":[{"count":24},{"count":32},{"count":41},{"count":47},{"count":38},{"count":32},{"count":24}]},{"week":20,"days":[{"count":25},{"count":40},{"count":36},{"count":24},{"count":47},{"count":47},{"count":24}]},{"week":21,"days":[{"count":24},{"count":35},{"count":48},{"count":48},{"count":34},{"count":50},{"count":23}]},{"week":22,"days":[{"count":23},{"count":35},{"count":30},{"count":33},{"count":41},{"count":35},{"count":24}]},{"week":23,"days":[{"count":24},{"count":34},{"count":36},{"count":34},{"count":34},{"count":33},{"count":24}]},{"week":24,"days":[{"count":26},{"count":34},{"count":36},{"count":36},{"count":40},{"count":34},{"count":24}]},{"week":25,"days":[{"count":25},{"count":41},{"count":35},{"count":34},{"count":34},{"count":34},{"count":24}]},{"week":26,"days":[{"count":25},{"count":36},{"count":42},{"count":39},{"count":48},{"count":38},{"count":24}]},{"week":27,"days":[{"count":24},{"count":44},{"count":53},{"count":40},{"count":38},{"count":34},{"count":24}]},{"week":28,"days":[{"count":24},{"count":38},{"count":34},{"count":36},{"count":34},{"count":44},{"count":24}]},{"week":29,"days":[{"count":24},{"count":43},{"count":35},{"count":37},{"count":43},{"count":52},{"count":24}]},{"week":30,"days":[{"count":24},{"count":39},{"count":42},{"count":34},{"count":37},{"count":35},{"count":25}]},{"week":31,"days":[{"count":24},{"count":36},{"count":45},{"count":35},{"count":39},{"count":41},{"count":24}]},{"week":32,"days":[{"count":24},{"count":35},{"count":33},{"count":38},{"count":35},{"count":45},{"count":24}]},{"week":33,"days":[{"count":25},{"count":31},{"count":45},{"count":43},{"count":44},{"count":55},{"count":24}]},{"week":34,"days":[{"count":33},{"count":48},{"count":37},{"count":44},{"count":38},{"count":38},{"count":24}]},{"week":35,"days":[{"count":24},{"count":35},{"count":35},{"count":43},{"count":43},{"count":46},{"count":24}]},{"week":36,"days":[{"count":24},{"count":41},{"count":40},{"count":41},{"count":47},{"count":39},{"count":24}]},{"week":37,"days":[{"count":30},{"count":45},{"count":38},{"count":46},{"count":37},{"count":35},{"count":24}]},{"week":38,"days":[{"count":24},{"count":24},{"count":24},{"count":24},{"count":40},{"count":34},{"count":24}]},{"week":39,"days":[{"count":24},{"count":34},{"count":39},{"count":65},{"count":34},{"count":34},{"count":39}]},{"week":40,"days":[{"count":24},{"count":25},{"count":58},{"count":46},{"count":46},{"count":41},{"count":30}]},{"week":41,"days":[{"count":24},{"count":37},{"count":43},{"count":39},{"count":35},{"count":40},{"count":24}]},{"week":42,"days":[{"count":24},{"count":38},{"count":34},{"count":34},{"count":20},{"count":10},{"count":23}]},{"week":43,"days":[{"count":24},{"count":36},{"count":34},{"count":36},{"count":46},{"count":35},{"count":24}]},{"week":44,"days":[{"count":25},{"count":44},{"count":40},{"count":35},{"count":38},{"count":37},{"count":24}]},{"week":45,"days":[{"count":24},{"count":38},{"count":42},{"count":41},{"count":35},{"count":39},{"count":24}]},{"week":46,"days":[{"count":24},{"count":38},{"count":35},{"count":33},{"count":37},{"count":34},{"count":24}]},{"week":47,"days":[{"count":25},{"count":38},{"count":36},{"count":54},{"count":35},{"count":38},{"count":25}]},{"week":48,"days":[{"count":24},{"count":36},{"count":70},{"count":48},{"count":42},{"count":50},{"count":24}]},{"week":49,"days":[{"count":24},{"count":48},{"count":34},{"count":36},{"count":34},{"count":28},{"count":29}]},{"week":50,"days":[{"count":40},{"count":37},{"count":35},{"count":36},{"count":34},{"count":40},{"count":24}]},{"week":51,"days":[{"count":28},{"count":44},{"count":45},{"count":40},{"count":38},{"count":34},{"count":24}]},{"week":52,"days":[{"count":26},{"count":45},{"count":40},{"count":34},{"count":35},{"count":34}]}]},
];

function getCurrentWeekNumber() {
    const currentDate = new Date();
    const startDate = new Date(currentDate.getFullYear(), 0, 1);
    const days = Math.floor((currentDate - startDate) / (24 * 60 * 60 * 1000));
          
    const weekNumber = Math.ceil((currentDate.getDay() + 1 + days) / 7);

    return weekNumber;
}

function getContributionData(username, setContributionData, setLoading) {
    setLoading(true);

    // const currentYear = new Date().getFullYear();
    // const currentYearsContributionsUrl = `https://cors-anywhere.herokuapp.com/https://skyline.github.com/${username}/${currentYear}.json`;
    // const previousYearsContributionsUrl = `https://cors-anywhere.herokuapp.com/https://skyline.github.com/${username}/${currentYear - 1}.json`;

    // console.log("Url 1:", currentYearsContributionsUrl);
    // console.log("Url 2:", previousYearsContributionsUrl);

    // Promise.all([
    //     fetch(currentYearsContributionsUrl),
    //     fetch(previousYearsContributionsUrl), 
    // ]).then((responses) => {
    //     return Promise.all(responses.map((response) => {
    //         return response.json();
    //     }))
    // }).then((data) => {
    //     const currentYearsContributionData = data[0];
    //     const previousYearsContributionData = data[1];

    //     const currentWeekNumber = getCurrentWeekNumber();
    //     const nWeeksFromPast = 52 - currentWeekNumber;

    //     const currentYearsHalf = currentYearsContributionData.contributions.slice(0, currentWeekNumber + 1);
    //     const lastYearsHalf = previousYearsContributionData.contributions.slice(52 - nWeeksFromPast + 1, 52 + 1);
    //     const contributions = lastYearsHalf.concat(currentYearsHalf);

    //     setContributionData({ 
    //         days: contributions.flatMap((contributionWeek) => contributionWeek.days.map((contributionDay) => contributionDay.count)),
    //         max: Math.max(currentYearsContributionData.max, previousYearsContributionData.max), 
    //         contributions: contributions,
    //     });
    //     setLoading(false);
    // })

        const currentYearsContributionData = data[0];
        const previousYearsContributionData = data[1];

        const currentWeekNumber = getCurrentWeekNumber();
        const nWeeksFromPast = 52 - currentWeekNumber;

        const currentYearsHalf = currentYearsContributionData.contributions.slice(0, currentWeekNumber + 1);
        const lastYearsHalf = previousYearsContributionData.contributions.slice(52 - nWeeksFromPast + 1, 52 + 1);
        const contributions = lastYearsHalf.concat(currentYearsHalf);

        setContributionData({ 
            days: contributions.flatMap((contributionWeek) => contributionWeek.days.map((contributionDay) => contributionDay.count)),
            max: Math.max(currentYearsContributionData.max, previousYearsContributionData.max), 
            min: Math.min(currentYearsContributionData.min, previousYearsContributionData.min),
            median: (currentYearsContributionData.median + previousYearsContributionData.median) / 2,  
            contributions: contributions,
        });
        setLoading(false);
}

export default getContributionData;
